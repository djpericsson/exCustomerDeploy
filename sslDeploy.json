{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "customerName": {
            "type": "string"
        },
        "webSiteName": {
            "type": "string"
        },
        "appServicePlanName": {
            "type": "string"
        },
        "webAppCertificateName": {
            "type": "string"
        },
        "location": {
            "type": "string",
            "defaultValue": "[resourceGroup().location]"
        }
    },
    "variables": {},
    "resources": [
        {
            "type": "Microsoft.Web/certificates",
            "name": "[parameters('webAppCertificateName')]",
            "apiVersion": "2016-03-01",
            "location": "[resourceGroup().location]",
            "properties": {
                "keyVaultId": "/subscriptions/692529f0-a0ae-4fb6-aa9e-a16df69f87cb/resourcegroups/alis/providers/microsoft.keyvault/vaults/alis-northeurope",
                "keyVaultSecretName": "addlevel-com7a8834e7-db14-4a74-ab70-3b8f1aa430b4",
                "serverFarmId": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourcegroup().name, '/providers/Microsoft.Web/serverfarms/', parameters('appServicePlanName'))]"
            }
        },
        {
          "type": "Microsoft.Web/sites",
          "name": "[parameters('webSiteName')]",
          "apiVersion": "2016-03-01",
          "location": "[resourceGroup().location]",
          "dependsOn": [
            "[resourceId('Microsoft.Web/certificates', parameters('webAppCertificateName'))]"
          ],
          "properties": {
            "name": "[parameters('webSiteName')]",
            "hostNameSslStates": [
              {
                "name": "[tolower(parameters('customerName'))]",
                "sslState": "SniEnabled",
                "thumbprint": "[reference(resourceId('Microsoft.Web/certificates', parameters('webAppCertificateName'))).Thumbprint]",
                "toUpdate": true
              }
            ]
          }
        }
    ]
}
